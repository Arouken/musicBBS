<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bbs.dao.MainPostDao">
	
	<!-- 获取所有帖子信息 -->
<!-- 	<select id="getMainPostList"  resultType="com.bbs.pojo.MainPost"> -->
<!-- 		select * from main_post -->
<!-- 	</select> -->
	
	<select id="getMainPostList"  resultMap="mainPostUser">
		select * from main_post order by mainPostTime desc
	</select>
		
	<resultMap type="com.bbs.pojo.MainPost" id="mainPostUser">
		<result property="userID" column="userID"/>
		<result property="mainPostID" column="mainPostID"/>
		<result property="mainPostTitle" column="mainPostTitle"/>
		<result property="mainPostTime" column="mainPostTime"/>
		<result property="mainPostContent" column="mainPostContent"/>
		<result property="mainPostGoodCount" column="mainPostGoodCount"/>
		<result property="mainPostIsLocked" column="mainPostIsLocked"/>
		<result property="mainPostImg" column="mainPostImg"/>
		<result property="categoryName" column="categoryName"/>
		<association property="user" column="userID" javaType="com.bbs.pojo.User" select="getUser">
		</association>		
	</resultMap>
	<!-- 用于展示帖子用户信息	 -->
	<select id="getUser"  resultType="com.bbs.pojo.User">
		select * from user where userID = #{userID}
	</select>

	<select id="getReportMainList" resultType="com.bbs.pojo.MainPost">
		SELECT * FROM main_post 
		WHERE mainPostID IN(
			SELECT mainPostID FROM report_mp 
			WHERE reportIsDeal = 0) 
		order by mainReportCount desc
	</select>
	
	
	<!-- 发帖子 -->
	<insert id="addMainPost" parameterType="com.bbs.pojo.MainPost">
		insert into main_post(userID,mainPostTitle,mainPostTime,mainPostContent,mainPostImg,categoryName) 
		values(#{userID},#{mainPostTitle},#{mainPostTime},#{mainPostContent},#{mainPostImg},#{categoryName})
	</insert>
	
	<!-- 获取一个帖子信息 -->
	<select id="getOneMainPost" parameterType="int" resultMap="oneMainPostUser">
		select * from main_post where mainPostID = #{mainPostID}
	</select>	
	<resultMap type="com.bbs.pojo.MainPost" id="oneMainPostUser">
		<result property="userID" column="userID"/>
		<result property="mainPostID" column="mainPostID"/>
		<result property="mainPostTitle" column="mainPostTitle"/>
		<result property="mainPostTime" column="mainPostTime"/>
		<result property="mainPostContent" column="mainPostContent"/>
		<result property="mainPostIsLocked" column="mainPostIsLocked"/>
		<result property="mainPostImg" column="mainPostImg"/>
		<result property="categoryName" column="categoryName"/>
		<association property="user" column="userID" javaType="com.bbs.pojo.User" select="getUser">
		</association>
	</resultMap>
	
<!-- 	搜索专区帖子 -->
	<select id="getCategoryPostList" parameterType="String" resultMap="oneMainPostUser">
		select * from main_post where categoryName = #{categoryName}
	</select>	


	
	<!-- 点赞,赞加一 -->
	<update id="addLikeCount" parameterType="com.bbs.pojo.MainPost">
		update main_post set mainPostLikeCount=mainPostLikeCount+1 where mainPostID = #{mainPostID}
	</update>
	
	<!-- 取消点赞，赞减一 -->
	<update id="deleteLikeCount" parameterType="com.bbs.pojo.MainPost">
		update main_post set mainPostLikeCount=mainPostLikeCount-1 where mainPostID = #{mainPostID}
	</update>
	
	<!-- 收藏,收藏加一 -->
	<update id="addCollectCount" parameterType="com.bbs.pojo.MainPost">
		update main_post set mainPostCollectCount=mainPostCollectCount+1 where mainPostID = #{mainPostID}
	</update>
	
	<!-- 取消收藏，收藏减一 -->
	<update id="deleteCollectCount" parameterType="com.bbs.pojo.MainPost">
		update main_post set mainPostCollectCount=mainPostCollectCount-1 where mainPostID = #{mainPostID}
	</update>
	
	<!-- 举报加一 -->
	<update id="addReportCount" parameterType="com.bbs.pojo.MainPost">
		update main_post set mainReportCount=mainReportCount+1 where mainPostID = #{mainPostID}
	</update>
	
	<!-- 举报减一 -->
	<update id="deleteReportCount" parameterType="com.bbs.pojo.MainPost">
		update main_post set mainReportCount=mainReportCount-1 where mainPostID = #{mainPostID}
	</update>
	
	<!-- 回复加一 -->
	<update id="addReplyCount" parameterType="com.bbs.pojo.MainPost">
		update main_post set mainPostReplyCount=mainPostReplyCount+1 where mainPostID = #{mainPostID}
	</update>
	
	<!-- 回复减一 -->
	<update id="deleteReplyCount" parameterType="com.bbs.pojo.MainPost">
		update main_post set mainPostReplyCount=mainPostReplyCount-1 where mainPostID = #{mainPostID}
	</update>
	

</mapper>